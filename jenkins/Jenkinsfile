node {
    awsUrl = '967699999360.dkr.ecr.ap-northeast-2.amazonaws.com'
    awsRepo = 'result'
    credentials = 'ecr:ap-northeast-2:ecr-credentials'
    buildNum = "${env.BUILD_NUMBER}"

    stage('âœ¨ Clone Repo') {
        checkout scm
    }

    stage('ğŸ—ï¸ Build') {
        sh "git update-index --add --chmod=+x gradlew"
        sh "./gradlew build"
    }
    
    stage('ğŸ³ Dk Build') {
        app = docker.build( imageName )
    }

    stage('ğŸš€ Push Image') {
        docker.withRegistry( 'https://' + awsUrl + '/' + awsRepo , credentials) {
            app.push(buildNum)
        }
    }

    stage("âš“ Helm Upt")  {
        build job : 'Build-test-4', parameters: [ 
                                                string(name: 'BUILD_NM', value: buildNum)
                                                 , string(name: 'AWS_URL', value: awsUrl) 
                                                 , string(name: 'REPO_NM', value: awsRepo)
                                                ]
    }
}
